{% extends "shared/_layout.html" %}
{% block title %}Clik User Page{% endblock %}
{% block main_content %}
   <div class="container">
   	<div class="row">
        <div class="col-md-4">
            <a href="/"><h4> Home </h4></a></div>
        <div class="col-md-4">
		    <a class = "active" href="/accounts/mypage"><h4> My Clik</h4></a></div>
        <div class="col-md-4">
            <a href="/accounts/login"><h4> My Profile</h4></a></div>
	</div>
   </div>

    <div class="container-fluid">
	    <div class='row'>
		    <div class="col-8" align="right" onload="draw()">
				<div id="viz"></div>
    	    </div>
		    <div class="col-4">
			    <h2>Cypher query: </h2>
			    <div style={background-color:"white"}>
				    <textarea rows="4" cols=30 id="cypher"></textarea><br>
				    <input type="submit" value="Submit" id="reload">
				    <input type="submit" value="Stabilize" id="stabilize">
			    </div>
		    </div>
	    </div>
    </div>

   <script>
   $(document).ready(function(){
        draw();
	});

   </script>
   <script type="text/javascript">
		// define config car
		// instantiate neovis object
		// draw

		var viz;

		function draw() {
			//var config = {
			//	container_id: "viz",
			//	server_url: "bolt://localhost:7687",
			//	server_user: "kelle",
			//	server_password: "111",
			//	labels: {
			//		//"Person": "name",
			//		"Person": {
			//			"caption": "first_name",
			//			"size": "2",
			//			"community": "10"
			//			//"sizeCypher": "MATCH (n) WHERE id(n) = {id} MATCH (n)-[r]-() RETURN sum(r.weight) AS c"
			//		},
			//		"Event":{
			//			"caption":"Location",
			//			"size": "1",
			//			"community": "5"
			//		}
			//	},
			//	relationships: {
			//		"interestedIn": {
			//			"thickness": 1,
			//			"caption": false
			//		}
			//	},
			//	initial_cypher: "MATCH n=(:Person), m=(:Event),p=(:Person)-[:interestedIn]->(:Event) RETURN n,m,p"
			//};
			var config = {
				container_id: "viz",
				server_url: "bolt://localhost:7687",
				server_user: "neo4j",
				server_password: "111",
				labels: {
					"user": {
						"caption": "name",
						"size": "2",
						"community": "10"
						//"sizeCypher": "MATCH (n) WHERE id(n) = {id} MATCH (n)-[r]-() RETURN sum(r.weight) AS c"
					},
					"Event":{
						"caption":"Location",
						"size": "1",
						"community": "5"
					}
				},
				relationships: {
					"interestedIn": {
						"thickness": 1,
						"caption": false
					}
				},
				initial_cypher: "MATCH n=(:user), m=(:Event),p=(:User)-[:interestedIn]->(:Event) RETURN n,m,p"
			};
			viz = new NeoVis.default(config);
			viz.render();
		};
</script>

<script>
	$("#reload").click(function() {
		var cypher = $("#cypher").val();
		if (cypher.length > 3) {
			viz.renderWithCypher(cypher);
		} else {
			console.log("reload");
			viz.reload();
		}
    });

	$("#stabilize").click(function() {
		viz.stabilize();
	});

</script>
{% endblock %}